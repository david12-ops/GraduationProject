import Head from 'next/head';
import React, { useState } from 'react';

import {
  useMutSuitableSuppMutation,
  useSuppDataQuery,
} from '@/generated/graphql';

import styles from '../styles/Home.module.css';
import { ResSuppCard } from './components/Cards/resSupp';
import { SearchAppBar2 } from './components/navbar2';

const Res = (dataSui: any, allSupp: any) => {
  const SuitableSupps: Array<any> = [];
  // eslint-disable-next-line @typescript-eslint/no-unsafe-call
  const sortedValues = dataSui.map((item: any) => {
    // eslint-disable-next-line @typescript-eslint/no-unsafe-return
    return item;
  });
  console.log(Object.values(sortedValues));
  // eslint-disable-next-line @typescript-eslint/no-unsafe-call, @typescript-eslint/no-unsafe-return
  sortedValues.forEach((itm: any) => {
    // eslint-disable-next-line @typescript-eslint/no-unsafe-call
    SuitableSupps.push({
      // eslint-disable-next-line @typescript-eslint/no-unsafe-call
      dataS: allSupp.data?.suplierData.find((item: any) => {
        return item.supplierId === itm.suppId;
      }),
      cost: itm.cost,
    });
    console.log('sorted val', itm.suppId);
    console.log('supplier', allSupp.data?.suplierData);
  });
  console.log('ssuitabel', SuitableSupps);

  // eslint-disable-next-line @typescript-eslint/no-unsafe-return
  return SuitableSupps ?? [];
};

// eslint-disable-next-line consistent-return
const RenderSupp = (dataFromResover: any, QueryData: any) => {
  // alert(JSON.stringify(Res(dataFromResover, QueryData)));
  if (!QueryData.loading && !QueryData.error) {
    // eslint-disable-next-line array-callback-return
    return Res(dataFromResover, QueryData).map((itm: any) => (
      <div key={itm.dataS.supplierId}>
        <ResSuppCard
          price={itm.cost}
          delivery={itm.dataS.delivery}
          folie={itm.dataS.foil}
          insurance={itm.dataS.insurance}
          packInBox={itm.dataS.packInBox}
          pickUp={itm.dataS.pickUp}
          sendCash={itm.dataS.sendCashDelivery}
          shippingLabel={itm.dataS.shippingLabel}
          name={itm.dataS.suppName}
        />
      </div>
    ));
  }
  return <div>Please Wait</div>;
};

export default function SuitableSupp() {
  const [dataS, SetData] = useState([]);
  const [width, SetWidth] = useState('');
  const [height, SetHeight] = useState('');
  const [weight, SetWeight] = useState('');
  const [plength, SetLength] = useState('');

  const Inputs = () => {
    return (
      <div>
        <div>
          <input
            type="text"
            onChange={() => SetWeight(event.target.value)}
            placeholder="Enter num here..."
          />
        </div>
        <div>
          <input
            type="text"
            onChange={() => SetHeight(event.target.value)}
            placeholder="Enter num here..."
          />
        </div>
        <div>
          <input
            type="text"
            onChange={() => SetWidth(event.target.value)}
            placeholder="Enter num here..."
          />
        </div>
        <div>
          <input
            type="text"
            onChange={() => SetLength(event.target.value)}
            placeholder="Enter num here..."
          />
        </div>
      </div>
    );
  };

  // eslint-disable-next-line @typescript-eslint/no-unsafe-call
  const [suitableSupp] = useMutSuitableSuppMutation();
  const suppData = useSuppDataQuery();

  const HandleForm = async () => {
    // eslint-disable-next-line @typescript-eslint/no-unsafe-call
    const result = await suitableSupp({
      variables: {
        Width: Number(width) ?? width,
        Weight: Number(weight) ?? weight,
        Height: Number(height) ?? height,
        Length: Number(plength) ?? plength,
      },
    })
      .then((res) => {
        // eslint-disable-next-line promise/always-return
        return res;
      })
      .catch((error: string) => {
        return { err: error };
      });

    if (result.err) {
      return alert(result.err);
    }

    if (result.data?.BingoSupPac?.suitable) {
      const data = JSON.parse(result.data?.BingoSupPac?.suitable);
      SetData(data);
    } else {
      // eslint-disable-next-line no-alert
      return alert(result.data?.BingoSupPac?.message);
    }
  };
  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <SearchAppBar2 />

      <main className={styles.main}>
        {Inputs()}
        <button onClick={HandleForm}>odeslat</button>
        {RenderSupp(dataS, suppData)}
      </main>

      <footer className={styles.footer}></footer>
    </div>
  );
}
